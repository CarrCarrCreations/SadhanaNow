<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: services/UserServiceImpl.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: services/UserServiceImpl.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import generateToken from "../utils/generateToken.js";
import { Error } from "../middleware/errorMiddleware.js";
import User from "../models/userModel.js";

/**
 * @function authUserEmailAndPassword
 * @description Authenticate user by supplied email and password.
 * &lt;br>if successful, generate JTW token and return found user.
 * @param {string} email
 * @param {string} password
 * @returns {User} User
 */
const authUserEmailAndPassword = (UserRepo) => async (email, password) => {
  const user = await UserRepo.findUserByEmail(email);

  if (user &amp;&amp; (await user.matchPassword(password))) {
    return {
      _id: user._id,
      displayName: user.displayName,
      email: user.email,
      isAdmin: user.isAdmin,
      token: generateToken(user._id),
    };
  } else {
    throw Error("UserService: Invalid email or password", 400);
  }
};

const getLoggedInUserProfile = () =>
  /**
   *Get the logged in user from the JWT Token
   * @param {User} User supplied from req.user
   * @returns {User} User
   */
  (user) => {
    if (user) {
      return {
        _id: user._id,
        displayName: user.displayName,
        email: user.email,
        isAdmin: user.isAdmin,
      };
    } else {
      throw Error("User not found", 400);
    }
  };

const updateUserProfile = (UserRepo) =>
  /**
   * Update the currently logged in user
   * @param {User} user - User supplied from req.user
   * @param {Object} reqBody - body supplied from the req.body
   * @returns {User} User
   */
  async (user, reqBody) => {
    if (user) {
      user.displayName = reqBody.displayName || user.displayName;
      user.email = reqBody.email || user.email;
      if (reqBody.password) {
        user.password = reqBody.password;
      }

      const updatedUser = await UserRepo.save();

      return {
        _id: updatedUser._id,
        displayName: updatedUser.displayName,
        email: updatedUser.email,
        isAdmin: updatedUser.isAdmin,
        token: generateToken(updatedUser._id),
      };
    } else {
      throw Error("User not found", 400);
    }
  };

const registerUser = (UserRepo) =>
  /**
   * Register a new User
   * @param {string} displayName
   * @param {string} email
   * @param {string} password
   * @returns {User} User
   */
  async (displayName, email, password) => {
    const userExists = await UserRepo.findOne({ email });
    if (userExists) {
      throw Error("User already exists.", 400);
    }

    const user = await UserRepo.create({
      displayName,
      email,
      password,
    });

    if (user) {
      return {
        _id: user._id,
        displayName: user.displayName,
        email: user.email,
        isAdmin: user.isAdmin,
        token: generateToken(user._id),
      };
    } else {
      throw Error("Invalid user data.", 400);
    }
  };
/**
 *  Object containing all helper methods for User objects
 * @param {Object} UserRepo - Object containing all DB methods for the Users
 */
const UserService = (UserRepo) => {
  return {
    authUserEmailAndPassword: authUserEmailAndPassword(UserRepo),
    getLoggedInUserProfile: getLoggedInUserProfile(),
    updateUserProfile: updateUserProfile(UserRepo),
    registerUser: registerUser(UserRepo),
  };
};

export default UserService;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="User.html">User</a></li></ul><h3>Global</h3><ul><li><a href="global.html#authUser">authUser</a></li><li><a href="global.html#authUserEmailAndPassword">authUserEmailAndPassword</a></li><li><a href="global.html#registerUser">registerUser</a></li><li><a href="global.html#updateUserProfile">updateUserProfile</a></li><li><a href="global.html#UserService">UserService</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Fri Mar 05 2021 10:34:26 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
