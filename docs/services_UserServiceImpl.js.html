<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: services/UserServiceImpl.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: services/UserServiceImpl.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import generateToken from "../utils/generateToken.js";
import User from "../models/User.js";
import { Error } from "../middleware/errorMiddleware.js";
import UserRepo from "../repos/user/UserRepo.js";

const authUserEmailAndPassword = (UserRepo) => async (email, password) => {
  const user = await UserRepo.findUserByEmail(email);

  if (user &amp;&amp; (await user.matchPassword(password))) {
    return new User({
      _id: user._id,
      displayName: user.displayName,
      email: user.email,
      isAdmin: user.isAdmin,
      token: generateToken(user._id),
    });
  } else {
    throw Error("UserService: Invalid email or password", 400);
  }
};

const getLoggedInUserProfile = () => (user) => {
  if (user) {
    return new User({
      _id: user._id,
      displayName: user.displayName,
      email: user.email,
      isAdmin: user.isAdmin,
    });
  } else {
    throw Error("User not found", 400);
  }
};

const updateUserProfile = (UserRepo) => async (user, reqBody) => {
  if (user) {
    user.displayName = reqBody.displayName || user.displayName;
    user.email = reqBody.email || user.email;
    if (reqBody.password) {
      user.password = reqBody.password;
    }

    const updatedUser = await UserRepo.save();

    return new User({
      _id: updatedUser._id,
      displayName: updatedUser.displayName,
      email: updatedUser.email,
      isAdmin: updatedUser.isAdmin,
      token: generateToken(updatedUser._id),
    });
  } else {
    throw Error("User not found", 400);
  }
};

const registerUser = (UserRepo) => async (displayName, email, password) => {
  const userExists = await UserRepo.findOne({ email });
  if (userExists) {
    throw Error("User already exists.", 400);
  }

  const user = await UserRepo.create({
    displayName,
    email,
    password,
  });

  if (user) {
    return new User({
      _id: user._id,
      displayName: user.displayName,
      email: user.email,
      isAdmin: user.isAdmin,
      token: generateToken(user._id),
    });
  } else {
    throw Error("Invalid user data.", 400);
  }
};

const getUserById = (UserRepo) => async (userId) => {
  const user = await UserRepo.findById(userId).select("-password");

  if (user) {
    return user;
  } else {
    throw new Error("User not found", 404);
  }
};

const getAllUsers = (UserRepo) => async () => {
  return await UserRepo.find();
};
/**
 *  Object containing all helper methods for User objects
 * @module UserService
 * @param {Object} UserRepo - Object containing all DB methods to interact with User objects
 */
const UserService = (UserRepo) => {
  return {
    /**
     * @function authUserEmailAndPassword
     * @description Authenticate user by supplied email and password.
     * &lt;br>if successful, generate JTW token and return found user.
     * @param {string} email
     * @param {string} password
     * @returns {User} User
     */
    authUserEmailAndPassword: authUserEmailAndPassword(UserRepo),
    /**
     * @function getLoggedInUserProfile
     * @description Get the logged in user from the JWT Token
     * @param {User} User supplied from req.user
     * @returns {User} User
     */
    getLoggedInUserProfile: getLoggedInUserProfile(),
    /**
     * @function updateUserProfile
     * @description Update the currently logged in user
     * @param {User} user - User supplied from req.user
     * @param {Object} reqBody - body supplied from the req.body
     * @returns {User} User
     */
    updateUserProfile: updateUserProfile(UserRepo),
    /**
     * @function registerUser
     * @description Register a new User
     * @param {string} displayName
     * @param {string} email
     * @param {string} password
     * @returns {User} User
     */
    registerUser: registerUser(UserRepo),
    /**
     * @function getAllUsers
     * @description Returns all users in the DB
     * @returns {User[]} Array of Users
     */
    getAllUsers: getAllUsers(UserRepo),
    /**
     * @function getUserById
     * @description Returns User by supplied ID
     * @param {string} userId
     * @returns {User} User
     */
    getUserById: getUserById(UserRepo),
  };
};

export default UserService;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-UserController.html">UserController</a></li><li><a href="module-UserRepo.html">UserRepo</a></li><li><a href="module-UserService.html">UserService</a></li></ul><h3>Classes</h3><ul><li><a href="User.html">User</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Wed Mar 10 2021 11:06:15 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
